{"version":3,"sources":["../src/functions.ts"],"names":[],"mappings":"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","file":"functions.js","sourcesContent":["/**\r\n * Function Registration System\r\n * \r\n * Utilities for creating and managing voice-callable functions\r\n */\r\n\r\nimport type {\r\n  VoiceFunctionConfig,\r\n  OpenAIFunctionDefinition,\r\n  JSONSchema,\r\n  JSONSchemaProperty,\r\n} from './types'\r\n\r\n/**\r\n * Create a type-safe voice function configuration\r\n * \r\n * @example\r\n * ```ts\r\n * const searchProducts = createVividFunction({\r\n *   name: 'searchProducts',\r\n *   description: 'Search for products in the catalog',\r\n *   parameters: {\r\n *     type: 'object',\r\n *     properties: {\r\n *       query: { type: 'string', description: 'Search query' },\r\n *       limit: { type: 'number', description: 'Max results' },\r\n *     },\r\n *     required: ['query'],\r\n *   },\r\n *   handler: async ({ query, limit }) => {\r\n *     // Your implementation\r\n *     return results\r\n *   },\r\n * })\r\n * ```\r\n */\r\nexport function createVividFunction<\r\n  TParams extends Record<string, unknown> = Record<string, unknown>,\r\n  TResult = unknown,\r\n>(config: VoiceFunctionConfig<TParams, TResult>): VoiceFunctionConfig<TParams, TResult> {\r\n  // Validate function name (OpenAI requirements)\r\n  if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(config.name)) {\r\n    throw new Error(\r\n      `Invalid function name \"${config.name}\". Must start with a letter or underscore and contain only alphanumeric characters and underscores.`\r\n    )\r\n  }\r\n\r\n  // Validate description is present\r\n  if (!config.description || config.description.trim().length === 0) {\r\n    throw new Error(`Function \"${config.name}\" must have a description.`)\r\n  }\r\n\r\n  // Set default execution context\r\n  return {\r\n    ...config,\r\n    executionContext: config.executionContext ?? 'client',\r\n  }\r\n}\r\n\r\n/**\r\n * Function registry for managing registered functions\r\n */\r\nexport class FunctionRegistry {\r\n  private functions: Map<string, VoiceFunctionConfig> = new Map()\r\n\r\n  /**\r\n   * Register a function\r\n   */\r\n  register(config: VoiceFunctionConfig): void {\r\n    if (this.functions.has(config.name)) {\r\n      console.warn(`[Vivid] Function \"${config.name}\" is already registered. Overwriting.`)\r\n    }\r\n    this.functions.set(config.name, config)\r\n  }\r\n\r\n  /**\r\n   * Register multiple functions at once\r\n   */\r\n  registerAll(configs: VoiceFunctionConfig[]): void {\r\n    for (const config of configs) {\r\n      this.register(config)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Unregister a function by name\r\n   */\r\n  unregister(name: string): boolean {\r\n    return this.functions.delete(name)\r\n  }\r\n\r\n  /**\r\n   * Get a function by name\r\n   */\r\n  get(name: string): VoiceFunctionConfig | undefined {\r\n    return this.functions.get(name)\r\n  }\r\n\r\n  /**\r\n   * Check if a function is registered\r\n   */\r\n  has(name: string): boolean {\r\n    return this.functions.has(name)\r\n  }\r\n\r\n  /**\r\n   * Get all registered functions\r\n   */\r\n  getAll(): VoiceFunctionConfig[] {\r\n    return Array.from(this.functions.values())\r\n  }\r\n\r\n  /**\r\n   * Get all client-side functions\r\n   */\r\n  getClientFunctions(): VoiceFunctionConfig[] {\r\n    return this.getAll().filter((fn) => fn.executionContext === 'client')\r\n  }\r\n\r\n  /**\r\n   * Get all server-side functions\r\n   */\r\n  getServerFunctions(): VoiceFunctionConfig[] {\r\n    return this.getAll().filter((fn) => fn.executionContext === 'server')\r\n  }\r\n\r\n  /**\r\n   * Convert all registered functions to OpenAI tool definitions\r\n   */\r\n  toOpenAITools(): OpenAIFunctionDefinition[] {\r\n    return this.getAll().map(functionToOpenAITool)\r\n  }\r\n\r\n  /**\r\n   * Clear all registered functions\r\n   */\r\n  clear(): void {\r\n    this.functions.clear()\r\n  }\r\n\r\n  /**\r\n   * Get the count of registered functions\r\n   */\r\n  get size(): number {\r\n    return this.functions.size\r\n  }\r\n}\r\n\r\n/**\r\n * Convert a VoiceFunctionConfig to OpenAI function definition\r\n */\r\nexport function functionToOpenAITool(config: VoiceFunctionConfig): OpenAIFunctionDefinition {\r\n  return {\r\n    name: config.name,\r\n    description: config.description,\r\n    parameters: config.parameters,\r\n  }\r\n}\r\n\r\n/**\r\n * Execute a function from the registry\r\n * Handles both sync and async functions\r\n */\r\nexport async function executeFunction(\r\n  registry: FunctionRegistry,\r\n  name: string,\r\n  args: Record<string, unknown>\r\n): Promise<{\r\n  success: boolean\r\n  result?: unknown\r\n  error?: string\r\n  executionTime: number\r\n}> {\r\n  const startTime = performance.now()\r\n  \r\n  const fn = registry.get(name)\r\n  if (!fn) {\r\n    return {\r\n      success: false,\r\n      error: `Function \"${name}\" not found`,\r\n      executionTime: performance.now() - startTime,\r\n    }\r\n  }\r\n\r\n  try {\r\n    const result = await fn.handler(args)\r\n    return {\r\n      success: true,\r\n      result,\r\n      executionTime: performance.now() - startTime,\r\n    }\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : String(error),\r\n      executionTime: performance.now() - startTime,\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Helper to create a simple string parameter\r\n */\r\nexport function stringParam(description: string, required = true): JSONSchemaProperty & { _required?: boolean } {\r\n  return { type: 'string', description, _required: required } as JSONSchemaProperty & { _required?: boolean }\r\n}\r\n\r\n/**\r\n * Helper to create a number parameter\r\n */\r\nexport function numberParam(description: string, required = false): JSONSchemaProperty & { _required?: boolean } {\r\n  return { type: 'number', description, _required: required } as JSONSchemaProperty & { _required?: boolean }\r\n}\r\n\r\n/**\r\n * Helper to create a boolean parameter\r\n */\r\nexport function booleanParam(description: string, required = false): JSONSchemaProperty & { _required?: boolean } {\r\n  return { type: 'boolean', description, _required: required } as JSONSchemaProperty & { _required?: boolean }\r\n}\r\n\r\n/**\r\n * Helper to create an enum parameter\r\n */\r\nexport function enumParam(description: string, options: string[], required = false): JSONSchemaProperty & { _required?: boolean } {\r\n  return { type: 'string', description, enum: options, _required: required } as JSONSchemaProperty & { _required?: boolean }\r\n}\r\n\r\n/**\r\n * Helper to build parameters schema from param helpers\r\n */\r\nexport function buildParameters(\r\n  params: Record<string, JSONSchemaProperty & { _required?: boolean }>\r\n): JSONSchema {\r\n  const properties: Record<string, JSONSchemaProperty> = {}\r\n  const required: string[] = []\r\n\r\n  for (const [key, param] of Object.entries(params)) {\r\n    const { _required, ...prop } = param as JSONSchemaProperty & { _required?: boolean }\r\n    properties[key] = prop\r\n    if (_required) {\r\n      required.push(key)\r\n    }\r\n  }\r\n\r\n  return {\r\n    type: 'object',\r\n    properties,\r\n    ...(required.length > 0 ? { required } : {}),\r\n  }\r\n}\r\n"]}